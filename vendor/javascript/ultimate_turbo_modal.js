// ultimate_turbo_modal@2.0.3 downloaded from https://ga.jspm.io/npm:ultimate_turbo_modal@2.0.3/dist/ultimate_turbo_modal.min.js

import{Controller as l}from"@hotwired/stimulus";async function t(l,c,u){const f=c.dataset,m=u?`${u}-${l}`:l;let h=`transition${l.charAt(0).toUpperCase()+l.slice(1)}`;const p=f[h]?f[h].split(" "):[m],b=f[`${h}Start`]?f[`${h}Start`].split(" "):[`${m}-start`],v=f[`${h}End`]?f[`${h}End`].split(" "):[`${m}-end`];n(c,p),n(c,b),await new Promise((l=>{requestAnimationFrame((()=>{requestAnimationFrame(l)}))})),o(c,b),n(c,v),await function(l){return new Promise((c=>{const u=getComputedStyle(l).transitionDuration.split(",")[0],f=1e3*Number(u.replace("s",""));setTimeout((()=>{c()}),f)}))}(c),o(c,v),o(c,p)}function n(l,c){l.classList.add(...c)}function o(l,c){l.classList.remove(...c)}const c="2.0.3";class i extends l{static targets=["container","content"];static values={advanceUrl:String,allowedClickOutsideSelector:String};connect(){let l=this;this.#e(),this.showModal(),this.turboFrame=this.element.closest("turbo-frame"),window.addEventListener("popstate",(function(c){l.#t()&&l.#n()})),window.modal=this}disconnect(){window.modal=void 0}showModal(){!async function(l,c=null){l.classList.remove("hidden"),await t("enter",l,c)}(this.containerTarget),this.advanceUrlValue&&!this.#t()&&(this.#o(),history.pushState({},"",this.advanceUrlValue))}hideModal(){if(this.hidingModal)return;this.hidingModal=!0;let l=new Event("modal:closing",{cancelable:!0});this.turboFrame.dispatchEvent(l),l.defaultPrevented||(this.#n(),l=new Event("modal:closed",{cancelable:!1}),this.turboFrame.dispatchEvent(l),this.#t()&&history.back())}hide(){this.hideModal()}refreshPage(){window.Turbo.visit(window.location.href,{action:"replace"})}submitEnd(l){l.detail.success&&this.hideModal()}closeWithKeyboard(l){"Escape"==l.code&&this.hideModal()}outsideModalClicked(l){let c=this.contentTarget.contains(l.target)||this.contentTarget==l.target,u=this.allowedClickOutsideSelectorValue&&""!==this.allowedClickOutsideSelectorValue&&null!=l.target.closest(this.allowedClickOutsideSelectorValue);c||u||this.hideModal()}#n(){(async function(l,c=null){await t("leave",l,c),l.classList.add("hidden")})(this.containerTarget).then((()=>{this.turboFrame.removeAttribute("src"),this.containerTarget.remove(),this.#r()}))}#t(){return"true"==document.body.getAttribute("data-turbo-modal-history-advanced")}#o(){return document.body.setAttribute("data-turbo-modal-history-advanced","true")}#r(){document.body.removeAttribute("data-turbo-modal-history-advanced")}#e(){const l=this.element.dataset.utmrVersion;l&&l!==c&&console.warn(`[UltimateTurboModal] Version Mismatch!\n\nGem Version: ${l}\nJS Version:  ${c}\n\nPlease ensure both the 'ultimate_turbo_modal' gem and the 'ultimate-turbo-modal' npm package are updated to the same version.\nElement:`,this.element)}}var u=function(){const e=()=>{},l={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:e,afterNodeAdded:e,beforeNodeMorphed:e,afterNodeMorphed:e,beforeNodeRemoved:e,afterNodeRemoved:e,beforeAttributeUpdated:e},head:{style:"merge",shouldPreserve:l=>"true"===l.getAttribute("im-preserve"),shouldReAppend:l=>"true"===l.getAttribute("im-re-append"),shouldRemove:e,afterHeadMorphed:e},restoreFocus:!0};const c=function(){function e(l,c,f,m){if(!1===m.callbacks.beforeNodeAdded(c))return null;if(m.idMap.has(c)){const h=document.createElement(c.tagName);return l.insertBefore(h,f),u(h,c,m),m.callbacks.afterNodeAdded(h),h}{const u=document.importNode(c,!0);return l.insertBefore(u,f),m.callbacks.afterNodeAdded(u),u}}const l=function(){function e(l,c,u){let f=l.idMap.get(c),m=l.idMap.get(u);if(!m||!f)return!1;for(const l of f)if(m.has(l))return!0;return!1}function t(l,c){const u=l,f=c;return u.nodeType===f.nodeType&&u.tagName===f.tagName&&(!u.id||u.id===f.id)}return function(l,c,u,f){let m=null,h=c.nextSibling,p=0,b=u;for(;b&&b!=f;){if(t(b,c)){if(e(l,b,c))return b;null===m&&(l.idMap.has(b)||(m=b))}if(null===m&&h&&t(b,h)&&(p++,h=h.nextSibling,p>=2&&(m=void 0)),b.contains(document.activeElement))break;b=b.nextSibling}return m||null}}();function n(l,c){if(l.idMap.has(c))a(l.pantry,c,null);else{if(!1===l.callbacks.beforeNodeRemoved(c))return;c.parentNode?.removeChild(c),l.callbacks.afterNodeRemoved(c)}}function r(l,c,u){let f=c;for(;f&&f!==u;){let c=f;f=f.nextSibling,n(l,c)}return f}function i(l,c,u,f){const m=f.target.id===c&&f.target||f.target.querySelector(`[id="${c}"]`)||f.pantry.querySelector(`[id="${c}"]`);return function(l,c){const u=l.id;for(;l=l.parentNode;){let f=c.idMap.get(l);f&&(f.delete(u),f.size||c.idMap.delete(l))}}(m,f),a(l,m,u),m}function a(l,c,u){if(l.moveBefore)try{l.moveBefore(c,u)}catch(f){l.insertBefore(c,u)}else l.insertBefore(c,u)}return function(c,f,m,h=null,p=null){f instanceof HTMLTemplateElement&&m instanceof HTMLTemplateElement&&(f=f.content,m=m.content),h||=f.firstChild;for(const b of m.childNodes){if(h&&h!=p){const f=l(c,b,h,p);if(f){f!==h&&r(c,h,f),u(f,b,c),h=f.nextSibling;continue}}if(b instanceof Element&&c.persistentIds.has(b.id)){const l=i(f,b.id,h,c);u(l,b,c),h=l.nextSibling;continue}const m=e(f,b,h,c);m&&(h=m.nextSibling)}for(;h&&h!=p;){const l=h;h=h.nextSibling,n(c,l)}}}(),u=function(){function e(l,c,u,f){const m=c[u];if(m!==l[u]){const h=t(u,l,"update",f);h||(l[u]=c[u]),m?h||l.setAttribute(u,""):t(u,l,"remove",f)||l.removeAttribute(u)}}function t(l,c,u,f){return!("value"!==l||!f.ignoreActiveValue||c!==document.activeElement)||!1===f.callbacks.beforeAttributeUpdated(l,c,u)}function o(l,c){return!!c.ignoreActiveValue&&l===document.activeElement&&l!==document.body}return function(l,u,f){return f.ignoreActive&&l===document.activeElement?null:(!1===f.callbacks.beforeNodeMorphed(l,u)||(l instanceof HTMLHeadElement&&f.head.ignore||(l instanceof HTMLHeadElement&&"morph"!==f.head.style?r(l,u,f):(!function(l,c,u){let f=c.nodeType;if(1===f){const f=l,m=c,h=f.attributes,p=m.attributes;for(const l of p)t(l.name,f,"update",u)||f.getAttribute(l.name)!==l.value&&f.setAttribute(l.name,l.value);for(let l=h.length-1;0<=l;l--){const c=h[l];if(c&&!m.hasAttribute(c.name)){if(t(c.name,f,"remove",u))continue;f.removeAttribute(c.name)}}o(f,u)||function(l,c,u){if(l instanceof HTMLInputElement&&c instanceof HTMLInputElement&&"file"!==c.type){let f=c.value,m=l.value;e(l,c,"checked",u),e(l,c,"disabled",u),c.hasAttribute("value")?m!==f&&(t("value",l,"update",u)||(l.setAttribute("value",f),l.value=f)):t("value",l,"remove",u)||(l.value="",l.removeAttribute("value"))}else if(l instanceof HTMLOptionElement&&c instanceof HTMLOptionElement)e(l,c,"selected",u);else if(l instanceof HTMLTextAreaElement&&c instanceof HTMLTextAreaElement){let f=c.value,m=l.value;if(t("value",l,"update",u))return;f!==m&&(l.value=f),l.firstChild&&l.firstChild.nodeValue!==f&&(l.firstChild.nodeValue=f)}}(f,m,u)}8!==f&&3!==f||l.nodeValue!==c.nodeValue&&(l.nodeValue=c.nodeValue)}(l,u,f),o(l,f)||c(f,l,u))),f.callbacks.afterNodeMorphed(l,u)),l)}}();function r(l,c,u){let f=[],m=[],h=[],p=[],b=new Map;for(const l of c.children)b.set(l.outerHTML,l);for(const c of l.children){let l=b.has(c.outerHTML),f=u.head.shouldReAppend(c),v=u.head.shouldPreserve(c);l||v?f?m.push(c):(b.delete(c.outerHTML),h.push(c)):"append"===u.head.style?f&&(m.push(c),p.push(c)):!1!==u.head.shouldRemove(c)&&m.push(c)}p.push(...b.values());let v=[];for(const c of p){let m=document.createRange().createContextualFragment(c.outerHTML).firstChild;if(!1!==u.callbacks.beforeNodeAdded(m)){if("href"in m&&m.href||"src"in m&&m.src){let l,c=new Promise((function(c){l=c}));m.addEventListener("load",(function(){l()})),v.push(c)}l.appendChild(m),u.callbacks.afterNodeAdded(m),f.push(m)}}for(const c of m)!1!==u.callbacks.beforeNodeRemoved(c)&&(l.removeChild(c),u.callbacks.afterNodeRemoved(c));return u.head.afterHeadMorphed(l,{added:f,kept:h,removed:m}),v}const f=function(){function e(){const l=document.createElement("div");return l.hidden=!0,document.body.insertAdjacentElement("afterend",l),l}function n(l){let c=Array.from(l.querySelectorAll("[id]"));return l.id&&c.push(l),c}function o(l,c,u,f){for(const m of f)if(c.has(m.id)){let c=m;for(;c;){let f=l.get(c);if(null==f&&(f=new Set,l.set(c,f)),f.add(m.id),c===u)break;c=c.parentElement}}}return function(c,u,f){const{persistentIds:m,idMap:h}=function(l,c){const u=n(l),f=n(c),m=function(l,c){let u=new Set,f=new Map;for(const{id:c,tagName:m}of l)f.has(c)?u.add(c):f.set(c,m);let m=new Set;for(const{id:l,tagName:h}of c)m.has(l)?u.add(l):f.get(l)===h&&m.add(l);for(const l of u)m.delete(l);return m}(u,f);let h=new Map;o(h,m,l,u);const p=c.__idiomorphRoot||c;return o(h,m,p,f),{persistentIds:m,idMap:h}}(c,u),p=function(c){let u=Object.assign({},l);return Object.assign(u,c),u.callbacks=Object.assign({},l.callbacks,c.callbacks),u.head=Object.assign({},l.head,c.head),u}(f),b=p.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(b))throw`Do not understand how to morph style ${b}`;return{target:c,newContent:u,config:p,morphStyle:b,ignoreActive:p.ignoreActive,ignoreActiveValue:p.ignoreActiveValue,restoreFocus:p.restoreFocus,idMap:h,persistentIds:m,pantry:e(),callbacks:p.callbacks,head:p.head}}}(),{normalizeElement:m,normalizeParent:h}=function(){const l=new WeakSet;class t{constructor(l){this.originalNode=l,this.realParentNode=l.parentNode,this.previousSibling=l.previousSibling,this.nextSibling=l.nextSibling}get childNodes(){const l=[];let c=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;c&&c!=this.nextSibling;)l.push(c),c=c.nextSibling;return l}querySelectorAll(l){return this.childNodes.reduce(((c,u)=>{if(u instanceof Element){u.matches(l)&&c.push(u);const f=u.querySelectorAll(l);for(let l=0;l<f.length;l++)c.push(f[l])}return c}),[])}insertBefore(l,c){return this.realParentNode.insertBefore(l,c)}moveBefore(l,c){return this.realParentNode.moveBefore(l,c)}get __idiomorphRoot(){return this.originalNode}}return{normalizeElement:function(l){return l instanceof Document?l.documentElement:l},normalizeParent:function n(c){if(null==c)return document.createElement("div");if("string"==typeof c)return n(function(c){let u=new DOMParser,f=c.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(f.match(/<\/html>/)||f.match(/<\/head>/)||f.match(/<\/body>/)){let m=u.parseFromString(c,"text/html");if(f.match(/<\/html>/))return l.add(m),m;{let c=m.firstChild;return c&&l.add(c),c}}{let f=u.parseFromString("<body><template>"+c+"</template></body>","text/html").body.querySelector("template").content;return l.add(f),f}}(c));if(l.has(c))return c;if(c instanceof Node){if(c.parentNode)return new t(c);{const l=document.createElement("div");return l.append(c),l}}{const l=document.createElement("div");for(const u of[...c])l.append(u);return l}}}}();return{morph:function(l,u,p={}){l=m(l);const b=h(u),v=f(l,b,p),g=function(l,c){if(!l.config.restoreFocus)return c();let u=document.activeElement;if(!(u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement))return c();const{id:f,selectionStart:m,selectionEnd:h}=u,p=c();f&&f!==document.activeElement?.id&&(u=l.target.querySelector(`[id="${f}"]`),u?.focus());u&&!u.selectionEnd&&h&&u.setSelectionRange(m,h);return p}(v,(()=>function(l,c,u,f){if(l.head.block){const m=c.querySelector("head"),h=u.querySelector("head");if(m&&h){const c=r(m,h,l);return Promise.all(c).then((()=>{const c=Object.assign(l,{head:{block:!1,ignore:!0}});return f(c)}))}}return f(l)}(v,l,b,(u=>"innerHTML"===u.morphStyle?(c(u,l,b),Array.from(l.childNodes)):function(l,u,f){const m=h(u);return c(l,m,f,u,u.nextSibling),Array.from(m.childNodes)}(u,l,b)))));return v.pantry.remove(),g},defaults:l}}();Turbo.StreamActions.modal=function(){const l=this.getAttribute("message");"hide"==l&&window.modal?.hide(),"close"==l&&window.modal?.hide()};const s=l=>{l.detail.response.redirected&&l.target==document.querySelector("turbo-frame#modal")&&(l.preventDefault(),l.detail.visit(l.detail.response))},d=l=>{"modal"===l.target.id&&(l.detail.render=(l,c)=>{u.morph(l,c,{morphstyle:"innerHTML"})})};document.removeEventListener("turbo:frame-missing",s),document.addEventListener("turbo:frame-missing",s),document.removeEventListener("turbo:before-frame-render",d),document.addEventListener("turbo:before-frame-render",d);export{i as UltimateTurboModalController};

